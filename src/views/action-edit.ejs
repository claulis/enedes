<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema ENEDES</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 font-sans">
    <header class="bg-blue-600 text-white p-4">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">Sistema ENEDES</h1>
            <nav>
                <a href="/dashboard" class="px-4">ðŸ“Š Dashboard</a>
                <a href="/export" class="px-4">ðŸ“¥ Exportar</a>
                <a href="/logout" class="px-4">ðŸšª Sair</a>
            </nav>
        </div>
    </header>

    <main class="container mx-auto p-6">
        <h2 class="text-2xl font-bold mb-6">Editar AÃ§Ã£o</h2>
        <% if (action) { %>
        <form action="/action/<%= action.id %>" method="POST" class="bg-white p-6 rounded-lg shadow-md">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label for="task" class="block text-sm font-medium text-gray-700">Tarefa</label>
                    <input type="text" id="task" name="task" value="<%= action.task %>" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                </div>
                <div>
                    <label for="responsible" class="block text-sm font-medium text-gray-700">ResponsÃ¡vel</label>
                    <input type="text" id="responsible" name="responsible" value="<%= action.responsible %>" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                </div>
                <div>
                    <label for="deadline" class="block text-sm font-medium text-gray-700">Prazo</label>
                    <input type="date" id="deadline" name="deadline" value="<%= action.deadline.toISOString().split('T')[0] %>" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                </div>
                <div>
                    <label for="budget" class="block text-sm font-medium text-gray-700">OrÃ§amento</label>
                    <input type="number" id="budget" name="budget" value="<%= action.budget %>" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                </div>
                <div>
                    <label for="status" class="block text-sm font-medium text-gray-700">Status</label>
                    <select id="status" name="status" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                        <option value="pendente" <%= action.status === 'pendente' ? 'selected' : '' %>>Pendente</option>
                        <option value="em_andamento" <%= action.status === 'em_andamento' ? 'selected' : '' %>>Em Andamento</option>
                        <option value="alerta" <%= action.status === 'alerta' ? 'selected' : '' %>>Alerta</option>
                        <option value="concluida" <%= action.status === 'concluida' ? 'selected' : '' %>>ConcluÃ­da</option>
                    </select>
                </div>
                <div>
                    <label for="description" class="block text-sm font-medium text-gray-700">DescriÃ§Ã£o</label>
                    <textarea id="description" name="description" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50"><%= action.description %></textarea>
                </div>
                <div>
                    <label for="note" class="block text-sm font-medium text-gray-700">Nota</label>
                    <textarea id="note" name="note" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50"><%= action.note %></textarea>
                </div>
                <div>
                    <label for="priority" class="block text-sm font-medium text-gray-700">Prioridade</label>
                    <select id="priority" name="priority" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                        <option value="baixa" <%= action.priority === 'baixa' ? 'selected' : '' %>>Baixa</option>
                        <option value="media" <%= action.priority === 'media' ? 'selected' : '' %>>MÃ©dia</option>
                        <option value="alta" <%= action.priority === 'alta' ? 'selected' : '' %>>Alta</option>
                    </select>
                </div>
                <div>
                    <label for="section" class="block text-sm font-medium text-gray-700">SeÃ§Ã£o</label>
                    <select id="section" name="section" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                        <% sections.forEach(section => { %>
                            <option value="<%= section %>" <%= action.section === section ? 'selected' : '' %>><%= section %></option>
                        <% }) %>
                    </select>
                </div>
                <div class="col-span-2">
                    <label class="block text-sm font-medium text-gray-700">Tarefas</label>
                    <div id="tasks-container" class="mt-2">
                        <% tasks.forEach((task, index) => { %>
                            <div class="task-item mb-2 flex items-center">
                                <input type="text" name="tasks[<%= index %>][description]" value="<%= task.description %>" class="flex-1 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                                <input type="checkbox" name="tasks[<%= index %>][completed]" <%= task.completed ? 'checked' : '' %> class="ml-2">
                            </div>
                        <% }) %>
                    </div>
                    <button type="button" onclick="addTask()" class="mt-2 text-blue-600 hover:underline">Adicionar Tarefa</button>
                </div>
            </div>
            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Atualizar AÃ§Ã£o</button>
        </form>
        <% } else { %>
            <p class="text-red-500">AÃ§Ã£o nÃ£o encontrada.</p>
        <% } %>
    </main>

    <script>
        // Safely initialize taskCount, defaulting to 0 if tasks is undefined or not an array
        let taskCount = <%= tasks.length %>;
        function addTask() {
            const container = document.getElementById('tasks-container');
            const taskItem = document.createElement('div');
            taskItem.className = 'task-item mb-2 flex items-center';
            taskItem.innerHTML = `
                <input type="text" name="tasks[${taskCount}][description]" placeholder="DescriÃ§Ã£o da tarefa" class="flex-1 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                <input type="checkbox" name="tasks[${taskCount}][completed]" class="ml-2">
            `;
            container.appendChild(taskItem);
            taskCount++;
        }
    </script>
</body>
</html>