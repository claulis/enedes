<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema ENEDES</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">Sistema ENEDES</h1>
            <nav>
                <a href="/export" class="mr-4">üì• Exportar</a>
                <a href="/logout" class="mr-4">üö™ Sair</a>
            </nav>
        </div>
    </header>

    <main class="container mx-auto mt-8 p-4">
        <% if (error) { %>
            <div class="bg-red-100 text-red-700 p-4 rounded mb-4">
                <%= error %>
            </div>
        <% } %>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <div class="bg-white p-4 rounded shadow">
                <h3 class="text-lg font-semibold mb-2">A√ß√µes Totais</h3>
                <p class="text-2xl font-bold"><%= stats ? stats.total_actions : 0 %></p>
            </div>
            <div class="bg-white p-4 rounded shadow">
                <h3 class="text-lg font-semibold mb-2">A√ß√µes Conclu√≠das</h3>
                <p class="text-2xl font-bold"><%= stats ? stats.completed_actions : 0 %></p>
            </div>
            <div class="bg-white p-4 rounded shadow">
                <h3 class="text-lg font-semibold mb-2">Notifica√ß√µes N√£o Lidas</h3>
                <p class="text-2xl font-bold"><%= stats ? stats.unread_notifications : 0 %></p>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div>
                <h2 class="text-2xl font-bold mb-4">Notifica√ß√µes</h2>
                <div class="bg-white p-6 rounded shadow">
                    <% if (notifications && notifications.length > 0) { %>
                        <ul class="space-y-4">
                            <% notifications.forEach(notification => { %>
                                <li class="border-b pb-4">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <p class="font-semibold"><%= notification.title %></p>
                                            <p class="text-gray-600"><%= notification.message %></p>
                                        </div>
                                        <a href="/notification/mark-read/<%= notification.id %>" class="text-blue-600 hover:underline">Marcar como lida</a>
                                    </div>
                                </li>
                            <% }) %>
                        </ul>
                    <% } else { %>
                        <p>Nenhuma notifica√ß√£o.</p>
                    <% } %>
                </div>
            </div>

            <div>
                <h2 class="text-2xl font-bold mb-4">Filtros</h2>
                <div class="bg-white p-6 rounded shadow">
                    <form action="/dashboard" method="GET">
                        <div class="mb-4">
                            <label for="section" class="block text-gray-700 font-bold">Se√ß√£o</label>
                            <select name="section" id="section" class="w-full p-2 border rounded">
                                <option value="">Selecione uma se√ß√£o...</option>
                                <% sections.forEach(section => { %>
                                    <option value="<%= section %>" <%= filters.section === section ? 'selected' : '' %>><%= section %></option>
                                <% }) %>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label for="status" class="block text-gray-700 font-bold">Status</label>
                            <select name="status" id="status" class="w-full p-2 border rounded">
                                <option value="">Todos</option>
                                <option value="pendente" <%= filters.status === 'pendente' ? 'selected' : '' %>>Pendente</option>
                                <option value="em_andamento" <%= filters.status === 'em_andamento' ? 'selected' : '' %>>Em Andamento</option>
                                <option value="alerta" <%= filters.status === 'alerta' ? 'selected' : '' %>>Alerta</option>
                                <option value="concluida" <%= filters.status === 'concluida' ? 'selected' : '' %>>Conclu√≠da</option>
                                <option value="atrasado" <%= filters.status === 'atrasado' ? 'selected' : '' %>>Atrasado</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label for="priority" class="block text-gray-700 font-bold">Prioridade</label>
                            <select name="priority" id="priority" class="w-full p-2 border rounded">
                                <option value="">Todos</option>
                                <option value="low" <%= filters.priority === 'low' ? 'selected' : '' %>>Baixa</option>
                                <option value="medium" <%= filters.priority === 'medium' ? 'selected' : '' %>>M√©dia</option>
                                <option value="high" <%= filters.priority === 'high' ? 'selected' : '' %>>Alta</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label for="search" class="block text-gray-700 font-bold">Buscar</label>
                            <input type="text" name="search" id="search" value="<%= filters.search || '' %>" class="w-full p-2 border rounded" placeholder="Digite para buscar...">
                        </div>
                        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Filtrar</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="mt-8">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">A√ß√µes</h2>
                <a href="/action/new" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Nova A√ß√£o</a>
            </div>
            <div class="bg-white p-6 rounded shadow">
                <% if (actions && actions.length > 0) { %>
                    <div class="space-y-4">
                        <% actions.forEach(action => { %>
                            <div class="border p-4 rounded">
                                <h3 class="text-lg font-semibold mb-2">
                                    <a href="/action/edit/<%= action.id %>" class="text-blue-600 hover:underline"><%= action.task %></a>
                                </h3>
                                <p>Respons√°vel: <%= action.responsible %></p>
                                <p>Se√ß√£o: <%= action.section_name %></p>
                                <p>Status: 
                                    <span class="px-2 py-1 rounded text-white <%= action.status === 'concluida' ? 'bg-green-600' : action.status === 'alerta' ? 'bg-yellow-600' : action.status === 'atrasado' ? 'bg-red-600' : action.status === 'em_andamento' ? 'bg-blue-600' : 'bg-gray-600' %>">
                                        <%= action.status %>
                                    </span>
                                </p>
                                <p>Prazo: <%= new Date(action.deadline).toLocaleDateString('pt-BR') %></p>
                                <p>Progresso: <%= action.progress %>%</p>
                                <h3 class="text-lg font-semibold mb-2">Tarefas:</h3>
                                <% if (action.tasks && action.tasks.length > 0) { %>
                                    <ul class="list-disc pl-5">
                                        <% action.tasks.forEach(task => { %>
                                            <li>
                                                <input type="checkbox" <%= task.completed ? 'checked' : '' %> disabled>
                                                <%= task.description %>
                                            </li>
                                        <% }) %>
                                    </ul>
                                <% } else { %>
                                    <p>Nenhuma tarefa.</p>
                                <% } %>
                                <h3 class="text-lg font-semibold mb-2">Anexos:</h3>
                                <% if (action.attachments && action.attachments.length > 0) { %>
                                    <ul class="list-disc pl-5">
                                        <% action.attachments.forEach(attachment => { %>
                                            <li>
                                                <a href="/attachment/action/<%= attachment.id %>" class="text-blue-600 hover:underline"><%= attachment.original_name %></a>
                                            </li>
                                        <% }) %>
                                    </ul>
                                <% } else { %>
                                    <p>Nenhum anexo.</p>
                                <% } %>
                                <h3 class="text-lg font-semibold mb-2">Follow-ups:</h3>
                                <% if (action.followUps && action.followUps.length > 0) { %>
                                    <ul class="list-disc pl-5">
                                        <% action.followUps.forEach(followUp => { %>
                                            <li>
                                                <a href="/follow-up/<%= followUp.id %>" class="text-blue-600 hover:underline"><%= followUp.title %></a>
                                            </li>
                                        <% }) %>
                                    </ul>
                                <% } else { %>
                                    <p>Nenhum follow-up.</p>
                                <% } %>
                                <h3 class="text-lg font-semibold mb-2">Atribui√ß√µes:</h3>
                                <% if (action.assignments && action.assignments.length > 0) { %>
                                    <ul class="list-disc pl-5">
                                        <% action.assignments.forEach(assignment => { %>
                                            <li>
                                                <%= assignment.status %> - 
                                                <%= assignment.collaborator_name || 'Colaborador ID: ' + assignment.collaborator_id %> 
                                                (<%= assignment.task_description || 'Tarefa ID: ' + assignment.task_id %>)
                                            </li>
                                        <% }) %>
                                    </ul>
                                <% } else { %>
                                    <p>Nenhuma atribui√ß√£o.</p>
                                <% } %>
                                <div class="mt-4 flex space-x-4">
                                    <a href="/action/edit/<%= action.id %>" class="text-blue-600 hover:underline">Editar</a>
                                    <a href="/action/delete/<%= action.id %>" class="text-red-600 hover:underline" onclick="return confirm('Tem certeza que deseja excluir esta a√ß√£o?')">Excluir</a>
                                </div>
                            </div>
                        <% }) %>
                    </div>
                <% } else { %>
                    <p>Nenhuma a√ß√£o encontrada.</p>
                <% } %>
            </div>
        </div>
    </main>
</body>
</html>